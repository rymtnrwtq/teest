(()=>{"use strict";const t=window,e=window.tb,i=e.utils.select,s=e.utils.selectAll,a=window.tb,n=a.utils.select,o=a.utils.selectAll;var l=function(t,e,i,s){var a,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(o=(n<3?a(o):n>3?a(e,i,o):a(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o},r=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const h="js-dot",d="sb-dots__dot_size_s",c="sb-dots__dot_active";class p{set activeSlide(t){if(!this.active)return;let e=this.slidesMap.indexOf(t);-1===e&&(e=this.reverseSlidesMap.indexOf(t)),this.setActiveItem(e)}constructor(t,e){this.root=t,this.slidesCount=e,this.dotsCount=0,this.slidesMap=[],this.reverseSlidesMap=[],this.visibleFirstIndex=0,this.visibleLastIndex=0,this.activeIndex=0,this.active=!!this.container,this.active&&this.init()}init(){this.container.addEventListener("click",(t=>{const e=t.target;if(e&&e.classList.contains(h)&&this.onSelectSlide){const t=Number(e.dataset.index)||0;this.onSelectSlide(t<this.slidesMap.length?this.slidesMap[t]:0)}}))}show(){this.active&&(this.container.style.display="")}hide(){this.active&&(this.container.style.display="none")}build(t){this.active&&(this.dotsCount=Math.ceil(this.slidesCount/t),this.buildMapsAndTemplates(t),this.visibleFirstIndex=0,this.visibleLastIndex=Math.min(4,this.dotsCount-1),this.activeIndex=Math.min(this.activeIndex,this.dotsCount-1),this.update())}buildMapsAndTemplates(t){let e="",i=this.slidesCount;this.slidesMap=[],this.reverseSlidesMap=[];for(let a=0;a<this.dotsCount;a++)e+=`<li class="js-dot-wrapper sb-dots__wrapper"><button class="${h} sb-dots__dot" data-index="${s=a}" aria-label="Элемент ${s+1}"></button></li>`,Math.trunc(i/t)>0?(this.slidesMap.push(a*t),i-=t,this.reverseSlidesMap.push(i)):(this.slidesMap.push(this.slidesCount-t),this.reverseSlidesMap.push(0));var s;this.reverseSlidesMap=this.reverseSlidesMap.sort(((t,e)=>t-e)),this.container.innerHTML=e}update(){this.elements.forEach(((t,e)=>{this.isSmallDot(e)?t.classList.add(d):t.classList.remove(d),e===this.activeIndex?t.classList.add(c):t.classList.remove(c)}));const t=-26*this.visibleFirstIndex;this.container.style.transform=`translateX(${t}px)`}isSmallDot(t){return!(this.slidesMap.length<=5)&&(t<=this.visibleFirstIndex&&0!==t||t>=this.visibleLastIndex&&t!==this.slidesMap.length-1)}setActiveItem(t){t!==this.activeIndex&&((t=Math.max(0,Math.min(this.slidesMap.length-1,t)))<=this.visibleFirstIndex?(this.visibleFirstIndex=Math.max(0,t-1),this.visibleLastIndex=Math.min(this.slidesMap.length-1,this.visibleFirstIndex+4)):t>=this.visibleLastIndex&&(this.visibleLastIndex=Math.min(this.slidesMap.length-1,t+1),this.visibleFirstIndex=Math.max(0,this.visibleLastIndex-4)),this.activeIndex=t,this.update())}}l([n(".js-dots"),r("design:type",HTMLElement)],p.prototype,"container",void 0),l([o(`.${h}`),r("design:type",Array)],p.prototype,"elements",void 0);class v{get dotsCount(){return this.items.length}get windowEndIndex(){return this.windowStartIndex+4}constructor(t,e){this.root=t,this.slidesCount=e,this.active=!1,this.activePageIndex=0,this.windowStartIndex=0,this.active=Boolean(this.container),this.active&&this.container.addEventListener("click",(({target:t})=>{t instanceof HTMLElement&&t.classList.contains(v.itemClassName)&&this.ondotclick(Number(t.dataset.index)||0)}))}setActiveItem(t){this.active&&this.activePageIndex!==t&&(this.activePageIndex=t,this.normalizeIndex(),this.updateUI())}normalizeIndex(){this.activePageIndex>=this.windowEndIndex?this.windowStartIndex=Math.max(this.activePageIndex-3,0):this.activePageIndex<=this.windowStartIndex&&(this.windowStartIndex=Math.max(this.activePageIndex-1,0))}buildUI(t){this.active&&(this.container.innerHTML=Array.from({length:Math.ceil(this.slidesCount/t)}).map(((t,e)=>`<li class="js-dot-wrapper sb-dots__wrapper">\n                    <button\n                        class="${v.itemClassName} sb-dots__dot"\n                        type="button" data-index="${e}" aria-label="Элемент ${e+1}"></button>\n                </li>`)).join(""),this.updateUI())}show(){this.active&&(this.container.style.display="")}hide(){this.active&&(this.container.style.display="none")}updateUI(){this.items.forEach(((t,e)=>{t.classList.toggle(v.itemActiveStateClassName,this.activePageIndex===e),t.classList.toggle(v.itemSmallStateClassName,this.isDotSmall(e)),this.container.style.transform=`translateX(${-26*this.windowStartIndex}px)`}))}isDotSmall(t){return!(this.dotsCount<=5||0===t||t===this.dotsCount-1)&&(this.windowStartIndex===t||this.windowEndIndex===t)}}v.itemClassName="js-dot",v.itemActiveStateClassName="sb-dots__dot_active",v.itemSmallStateClassName="sb-dots__dot_size_s",l([n(".js-dots"),r("design:type",HTMLElement)],v.prototype,"container",void 0),l([o(`.${v.itemClassName}`),r("design:type",Array)],v.prototype,"items",void 0);var u=function(t,e,i,s){var a,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(o=(n<3?a(o):n>3?a(e,i,o):a(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o},m=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const g="js-item-bottom_active",f="js-item-bottom-title",x=/[.,\\/#!$%\\^&\\*;:{}=\\-_\`~()]$/;class y{set activeSlide(t){this.active&&(this.activeSlideIndex=t,this.update())}constructor(t,e){this.root=t,this.slideDarkSchemas=e,this.titles=[],this.activeSlideIndex=0,this.active=!!t.classList.contains("js-with-navigation"),this.active&&this.init()}build(){this.active&&(this.items.forEach(((t,e)=>{const i=t.querySelector(`.${f}`);i&&((t,e)=>{if(t.scrollHeight<=t.offsetHeight)return;let i=0,s=e.length-1;for(;i<s;){const a=Math.round((i+s)/2);t.innerText=`${e.slice(0,a)}…`,t.scrollHeight>t.offsetHeight?s=a-5:i=a}t.innerText=`${e.slice(0,s-5).replace(x,"")}…\n${e.slice(s-5).replace(x,"")}`})(i,this.titles[e])})),this.update())}init(){this.items.forEach(((t,e)=>{0===e&&t.classList.add(g);const i=t.querySelector(`.${f}`);i&&this.titles.push(i.innerText)})),this.panel.addEventListener("click",(t=>{const e=Number(t.target.dataset.index);!isNaN(e)&&this.onSelectSlide&&this.onSelectSlide(e)}))}update(){const t=this.panel,e=this.slideDarkSchemas.length,i=this.bottom?Math.round(t.clientWidth/this.bottom.clientWidth):1;let s=0;if(this.activeSlideIndex>1&&e>i){const a=t.offsetWidth/i;s=this.activeSlideIndex>e-i+1?a*(e-i):a*(this.activeSlideIndex-1)}document.body.clientWidth<640?this.nativeScrollWrapper.scrollTo({left:s,behavior:"smooth"}):t.style.transform=`translateX(-${s}px)`,t.classList.remove("sb-text-dark"),t.classList.remove("sb-text-white"),t.classList.add(this.slideDarkSchemas[this.activeSlideIndex]?"sb-text-dark":"sb-text-white");const a=this.items;a[this.activeSlideIndex]&&(a.forEach((t=>t.classList.remove(g))),a[this.activeSlideIndex].classList.add(g))}}u([n(".js-list-bottom-row"),m("design:type",HTMLElement)],y.prototype,"panel",void 0),u([n(".js-item-bottom-wrapper","panel"),m("design:type",HTMLElement)],y.prototype,"bottom",void 0),u([o(".js-item-bottom","panel"),m("design:type",Array)],y.prototype,"items",void 0),u([n(".js-list-bottom-container"),m("design:type",HTMLElement)],y.prototype,"nativeScrollWrapper",void 0);var w=function(t,e,i,s){var a,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(o=(n<3?a(o):n>3?a(e,i,o):a(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o},b=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const I=t=>t<10?`0${t}`:`${t}`;class S{set activeSlide(t){this.active&&this.update(t)}constructor(t,e){this.root=t,this.slidesCount=e,this.active=!!this.counter,this.hasProgress=!!this.progressBar,this.active&&this.update(0)}update(t){this.hasProgress&&(this.progressBar.style.width=(t+1)/this.slidesCount*100+"%"),this.counter.innerHTML=`${I(t+1)} / ${I(this.slidesCount)}`}}w([n(".js-progress-bar-line-complete"),b("design:type",HTMLElement)],S.prototype,"progressBar",void 0),w([n(".js-progress-bar-count"),b("design:type",HTMLElement)],S.prototype,"counter",void 0);var M=function(t,e,i,s){var a,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(o=(n<3?a(o):n>3?a(e,i,o):a(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o},L=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const E={immediately:!1},P={continuousSliding:!0};function C(t,e=100){let i;return function(...s){clearTimeout(i),i=setTimeout((()=>t.apply(this,s)),e)}}class j{get activeSlideIndex(){return this.activePageIndex}get slidesCount(){return this.slideElements.length}get visibleSlidesCount(){return this.pageSize}get pagesCount(){return Math.ceil(this.slideElements.length/this.pageSize)}constructor(t,i,s=(()=>{})){var a,n;this.root=t,this.opts=i,this.activePageIndex=0,this.pageSize=0,this.listeners=new Map([["slidePrevious",()=>this.prev()],["slideNext",()=>this.next()]]),this.opts=Object.assign(Object.assign({},P),this.opts),this.root.classList.add("js-is-scroll-snap-slider"),null===(a=this.arrowNext)||void 0===a||a.addEventListener("click",(()=>this.next())),null===(n=this.arrowPrevious)||void 0===n||n.addEventListener("click",(()=>this.prev())),this.dots=new v(this.root,this.slidesCount),this.navigation=new y(this.root,this.slideElements.map((t=>t.classList.contains("sb-text-dark"))));const o=new S(this.root,this.slidesCount);this.opts.isVertical&&!this.wrapper.classList.contains("scroll-snap-y")&&this.wrapper.classList.add("scroll-snap-y"),this.wrapper.addEventListener("scroll",C((()=>{this.activePageIndex=this.opts.isVertical?Math.ceil(Math.trunc(this.wrapper.scrollTop)/Math.trunc(this.wrapper.clientHeight)):Math.ceil(Math.trunc(this.wrapper.scrollLeft)/Math.trunc(this.wrapper.clientWidth)),this.dots.setActiveItem(this.activePageIndex),this.navigation.activeSlide=this.activePageIndex,o.activeSlide=this.activePageIndex})),{passive:!0}),window.addEventListener("resize",C((()=>{this.calculatePageSize(),this.buildUI(),this.goto(this.activePageIndex,{immediately:!0})}),300),{passive:!0}),this.buildUI();const l=t=>{this.opts.isVertical?this.wrapper.scrollTo(0,this.wrapper.clientHeight*t):this.wrapper.scrollTo(this.wrapper.clientWidth*t,0)};this.dots.ondotclick=l,this.navigation.onSelectSlide=l,this.opts.listenPopups&&(window.addEventListener("needUpdateOffset",(()=>{this.calculatePageSize(),this.goto(this.activePageIndex,{immediately:!0})})),this.sliderElement.addEventListener("click",(t=>{const i=t.target.parentElement;if(!i||!i.classList.contains("sb-image-link"))return;const s=i.getAttribute("href").slice(1);e.modules.popups.isPopup(s)&&window.dispatchEvent(new CustomEvent("needUpdateOffset"))}))),"number"==typeof this.opts.entityIndex&&this.goto(i.entityIndex,{immediately:!0}),this.opts.onSlideChange&&this.opts.onSlideChange(this),s(this.listeners)}goto(t,e=E){const i=(s=0,a=t,n=this.pagesCount,Math.max(s,Math.min(a,n)));var s,a,n;const o=this.opts.slideSingleEntity?this.slideElements[0].clientWidth:this.wrapper.clientWidth*i,l=this.opts.slideSingleEntity?this.slideElements[0].clientHeight:this.wrapper.clientHeight*i,r=e.immediately?"instant":"smooth";this.opts.isVertical?this.wrapper.scrollTo({top:l,left:0,behavior:r}):this.wrapper.scrollTo({top:0,left:o,behavior:r})}next(){this.activePageIndex+1>=this.pagesCount?this.goto(0):this.goto(this.activePageIndex+1)}prev(){this.activePageIndex-1<0?this.goto(this.pagesCount-1):this.goto(this.activePageIndex-1)}buildUI(){this.calculatePageSize(),this.dots.buildUI(this.pageSize),this.navigation.build();let t=!0;this.slidesCount<=this.pageSize&&(t=!1),this.opts.deactivateWidth&&this.opts.deactivateWidth>=document.body.clientWidth&&(t=!1),t?this.showControls():(this.goto(0,{immediately:!0}),this.hideControls())}hideControls(){this.navigation.active||(this.root.classList.add("pointer-events-none"),this.arrowPrevious&&(this.arrowPrevious.style.display="none"),this.arrowNext&&(this.arrowNext.style.display="none"),this.dots.hide())}showControls(){this.navigation.active||(this.root.classList.remove("pointer-events-none"),this.arrowPrevious&&(this.arrowPrevious.style.display=""),this.arrowNext&&(this.arrowNext.style.display=""),this.dots.show())}calculatePageSize(){this.pageSize=this.opts.isVertical?this.wrapper.clientHeight/this.slideElements[0].clientHeight:this.wrapper.clientWidth/this.slideElements[0].clientWidth}}M([i(".js-list-wrapper"),L("design:type",HTMLElement)],j.prototype,"wrapper",void 0),M([s(".js-slide"),L("design:type",Array)],j.prototype,"slideElements",void 0),M([i(".js-list"),L("design:type",HTMLElement)],j.prototype,"sliderElement",void 0),M([i(".js-arrow_previous"),L("design:type",HTMLElement)],j.prototype,"arrowPrevious",void 0),M([i(".js-arrow_next"),L("design:type",HTMLElement)],j.prototype,"arrowNext",void 0),t.tbScrollSnapSlider={create:(t,e,i)=>new j(t,e,i)}})();